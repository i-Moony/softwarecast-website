---
import { getCollection, render } from 'astro:content';
import type { ImageMetadata } from 'astro';
import { Picture } from 'astro:assets';
import Default from '../../layouts/default.astro';

export async function getStaticPaths() {
    const episodes = await getCollection("episodes");

    return episodes.map(episode => ({
        params: { id: episode.id },
        props: { episode },
    }));
}

const { episode } = Astro.props;
const previews = import.meta.glob<{ default: ImageMetadata }>("/src/images/episodes/*.png", {eager: true});
const imagePath = `/src/images/episodes/${episode.data.episode_number}.png`

if (!previews[imagePath])
    throw new Error(`No preview!`);
---

<Default>
    <h1 class="intruder text-3xl lg:text-4xl xl:text-5xl text-center mb-4">{episode.data.title}</h1>
    <div class="p-4 md:p-8 pattern-background-animated inline-block rounded-2xl">
        <Picture src={previews[imagePath].default} alt="Превью" layout="constrained" width="600" formats={["avif", "webp", "jpeg", "png"]} class="rounded-xl"></Picture>
    </div>
</Default>
